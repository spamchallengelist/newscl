<html><head><base href="." /><title>Spam Challenge List</title>
<style>
  :root {
    --primary: #5C7AEA;
    --primary-light: #7B93ED;
    --primary-dark: #4563E6;
    --bg-dark: #0F172A;
    --bg-darker: #0B1120;
    --card-bg: #1E293B;
    --text: #E2E8F0;
    --text-muted: #94A3B8;
    --border: #2D3B55;
    
    /* Adding gradient variables */
    --gradient-primary: linear-gradient(135deg, var(--primary-light), var(--primary-dark));
    --gradient-bg: linear-gradient(135deg, var(--bg-dark), var(--bg-darker));
    --gradient-card: linear-gradient(135deg, #243B55, var(--card-bg));
  }

  body {
    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
    font-weight: bold;
    font-style: italic;
    background: var(--bg-dark);
    margin: 0;
    padding: 0;
    color: var(--text);
    min-height: 100vh;
    line-height: 1.5;
  }
  
  .header {
    background: var(--gradient-bg);
    padding: 1.5rem 1rem; /* Reduced padding */
    text-align: center;
    border-bottom: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .header h1 {
    font-size: 2rem; /* Smaller font size */
    font-weight: 900; /* Increased boldness */
    font-style: italic;
    margin: 0;
    background: linear-gradient(to right, var(--primary-light), var(--primary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: -0.5px; /* Added for modern look */
  }

  .header p {
    color: var(--text-muted);
    margin: 0.25rem 0 0; /* Reduced margin */
    font-size: 0.9rem; /* Slightly smaller font */
  }

  .nav {
    display: flex;
    justify-content: center;
    gap: 1rem; /* Reduced gap */
    padding: 0.75rem; /* Reduced padding */
    background: var(--bg-darker);
    border-bottom: 1px solid var(--border);
  }

  .nav a {
    color: var(--text-muted);
    text-decoration: none;
    padding: 0.4rem 0.8rem; /* Reduced padding */
    border-radius: 4px; /* Smaller border radius */
    transition: all 0.2s;
    font-weight: bold;
    font-style: italic;
    font-size: 0.9rem; /* Slightly smaller font */
  }

  .nav a:hover {
    background: var(--gradient-primary);
    color: white;
  }

  .container {
    max-width: 1000px;
    margin: 2rem auto;
    padding: 0 1.5rem;
  }

  .level-list {
    list-style: none;
    padding: 0;
    display: grid;
    gap: 1rem;
  }

  .level-item {
    background: var(--gradient-card);
    padding: 1.5rem;
    border-radius: 12px;
    border: 1px solid var(--border);
    display: flex;
    align-items: center;
    transition: all 0.3s ease;
  }

  .level-item:hover {
    transform: translateY(-2px);
    background: linear-gradient(135deg, #2a4966, var(--card-bg));
    border-color: var(--primary-light);
  }

  .level-rank {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gradient-primary);
    width: 3rem;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .level-info {
    flex-grow: 1;
  }

  .level-title {
    font-size: 1.25rem;
    font-weight: 900; /* Increased boldness */
    font-style: italic;
    margin-bottom: 0.25rem;
  }

  .level-creator {
    color: var(--text-muted);
    font-size: 0.875rem;
    font-weight: bold;
    font-style: italic;
    margin-bottom: 0.5rem;
  }

  .level-stats {
    display: flex;
    gap: 1.5rem;
    color: var(--text-muted);
    font-size: 0.875rem;
  }

  .leaderboard {
    margin-top: 40px;
    background: var(--gradient-card);
    padding: 20px;
    border-radius: 12px;
    border: 1px solid var(--border);
    max-height: 600px;
    overflow-y: auto;
  }

  .leaderboard-title {
    color: var(--gradient-primary);
    text-align: center;
    margin-bottom: 20px;
    font-weight: 900; /* Increased boldness */
    font-style: italic;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .player-list {
    list-style: none;
    padding: 0;
  }

  .player-item {
    display: flex;
    justify-content: space-between;
    padding: 12px;
    border-bottom: 1px solid var(--border);
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .player-item:hover {
    background: var(--bg-darker);
    transform: translateX(5px);
  }

  .submission-form {
    background: var(--bg-dark);
    padding: 20px;
    border-radius: 8px;
    margin-top: 20px;
    display: none;
  }

  .submission-form.active {
    display: block;
  }

  .form-group {
    margin-bottom: 15px;
  }

  .form-group label {
    display: block;
    margin-bottom: 5px;
    color: var(--text);
  }

  .form-group input, .form-group textarea {
    background: var(--bg-darker);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 0.5rem;
    border-radius: 6px;
    width: 100%;
    transition: border-color 0.2s;
  }

  .form-group input:focus, .form-group textarea:focus {
    border-color: var(--primary);
    outline: none;
  }

  .submit-btn {
    background: var(--gradient-primary);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    font-weight: 500;
    transition: all 0.2s;
  }

  .submit-btn:hover {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  }

  .admin-login {
    position: fixed;
    top: 12px;
    right: 12px;
    z-index: 100;
  }

  .admin-button {
    background: transparent;
    border: none;
    color: var(--text-muted);
    padding: 0.4rem;
    border-radius: 50%;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .admin-button:hover {
    background: var(--card-bg);
    color: var(--text);
  }

  .admin-button svg {
    width: 20px;
    height: 20px;
  }

  .admin-panel {
    background: var(--gradient-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 20px;
    z-index: 1000;
    width: 90%;
    max-width: 600px;
    max-height: 80vh; /* Limit height to 80% of viewport height */
    overflow-y: auto; /* Enable vertical scrolling */
  }

  .admin-panel.active {
    display: block;
  }

  .admin-panel h2 {
    color: var(--primary);
    margin-bottom: 20px;
  }

  .admin-grid {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 20px;
    max-height: 70vh; /* Limit height to 70% of viewport height */
    overflow-y: auto; /* Enable vertical scrolling */
  }

  .records-section {
    margin-bottom: 20px;
    padding: 15px;
    background: var(--bg-darker);
    border-radius: 8px;
    max-height: 300px;
    overflow-y: auto;
  }

  .record-item {
    background: var(--gradient-card);
    padding: 12px;
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1px solid var(--border);
  }

  .record-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }

  .accept-btn {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
  }

  .deny-btn {
    background: linear-gradient(135deg, #f44336, #d32f2f);
    color: white;
    border: none;
    padding: 5px 10px;
    border-radius: 4px;
    cursor: pointer;
  }

  .record-status {
    padding: 10px;
    margin-top: 20px;
    border-radius: 8px;
  }

  .record-status.pending {
    background: var(--gradient-card);
  }

  .record-status.denied {
    background: linear-gradient(135deg, #ffebee, #ffcdd2);
    color: #c62828;
  }

  /* Add styles for editable record fields */
  .record-edit {
    background: var(--bg-darker);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 4px 8px;
    border-radius: 4px;
    margin: 2px 0;
    font-size: 0.9em;
    width: 100%;
    max-width: 300px;
  }

  .record-edit:focus {
    border-color: var(--primary);
    outline: none;
  }

  .record-edit textarea {
    min-height: 60px;
    resize: vertical;
  }

  .record-details {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 12px;
  }

  /* Style for the level selection dropdown */
  .level-select {
    width: 100%;
    padding: 8px;
    background: var(--bg-darker);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: 6px;
  }

  .level-editor {
    background: var(--gradient-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    margin-bottom: 0.5rem;
  }

  .level-editor-header {
    padding: 1rem;
    border-bottom: 1px solid var(--border);
  }

  .toggle-icon {
    transition: transform 0.3s ease;
  }

  .close-admin {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: var(--text);
    font-size: 1.5em;
    cursor: pointer;
  }

  .overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    z-index: 999;
  }

  .overlay.active {
    display: block;
  }

  .login-form {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--gradient-bg);
    padding: 60px;
    border-radius: 8px;
    z-index: 1001;
    display: none;
  }

  .login-form.active {
    display: block;
  }

  .arrow-controls {
    display: flex;
    gap: 5px;
  }

  .arrow-btn {
    background: var(--gradient-primary);
    color: white;
    border: none;
    border-radius: 4px;
    padding: 0.25rem 0.5rem;
    transition: all 0.2s;
  }

  .arrow-btn:hover:not(:disabled) {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  }

  .arrow-btn:disabled {
    background: var(--card-bg);
    opacity: 0.5;
  }

  .level-editor-content {
    margin-top: 10px;
    padding: 10px;
    background: var(--bg-darker);
    border-radius: 4px;
    display: none;
  }

  /* Add styles for the player profile modal */
  .player-profile {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--gradient-bg);
    padding: 30px;
    border-radius: 12px;
    border: 1px solid var(--border);
    z-index: 1001;
    width: 90%;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
  }

  .player-profile.active {
    display: block;
  }

  .player-profile h2 {
    color: var(--primary);
    margin-bottom: 20px;
    font-size: 1.8rem;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .player-profile-stats {
    margin-bottom: 20px;
    padding: 15px;
    background: var(--bg-darker);
    border-radius: 8px;
  }

  .player-completions {
    display: grid;
    gap: 10px;
    margin-top: 15px;
  }

  .completion-item {
    background: var(--gradient-card);
    padding: 12px;
    border-radius: 8px;
    border: 1px solid var(--border);
  }

  .close-profile {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: var(--text);
    font-size: 1.5em;
    cursor: pointer;
  }

  /* Add styles for the victors dropdown */
  .victors-dropdown {
    margin-top: 0.5rem;
    display: none;
    background: var(--bg-darker);
    border-radius: 6px;
    padding: 0.75rem;
    border: 1px solid var(--border);
  }

  .victors-dropdown.active {
    display: block;
  }

  .victors-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .victors-list li {
    color: var(--text-muted);
    font-size: 0.875rem;
    padding: 0.25rem 0;
    border-bottom: 1px solid var(--border);
  }

  .victors-list li:last-child {
    border-bottom: none;
  }

  .toggle-victors {
    background: var(--gradient-primary);
    color: white;
    border: none;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    margin-top: 0.5rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .toggle-victors:hover {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  }

  /* Add styling for the cancel button */
  .login-form .button-group {
    display: flex;
    gap: 10px;
    margin-top: 15px;
  }

  .login-form .cancel-btn {
    background: var(--bg-darker);
    color: var(--text-muted);
    border: 1px solid var(--border);
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    font-weight: 500;
    transition: all 0.2s;
    cursor: pointer;
  }

  .login-form .cancel-btn:hover {
    background: var(--card-bg);
    color: var(--text);
  }

  /* Admin tab navigation styles */
  .admin-tab-navigation {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    border-bottom: 1px solid var(--border);
    padding-bottom: 0.5rem;
  }

  .admin-tab {
    color: var(--text-muted);
    background: none;
    border: none;
    padding: 0.5rem 1rem;
    cursor: pointer;
    border-radius: 4px;
    transition: all 0.2s;
  }

  .admin-tab.active {
    background: var(--gradient-primary);
    color: white;
  }

  .admin-tab-content {
    display: none;
  }

  .admin-tab-content.active {
    display: block;
  }

  .profile-editor {
    background: var(--gradient-card);
    padding: 20px;
    border-radius: 12px;
    margin-top: 20px;
    border: 1px solid var(--border);
  }

  .profile-search {
    margin-bottom: 1rem;
  }

  .profile-search input {
    width: 100%;
    padding: 0.5rem;
    background: var(--bg-darker);
    border: 1px solid var(--border);
    color: var(--text);
    border-radius: 4px;
  }

  .profile-list {
    max-height: 300px;
    overflow-y: auto;
  }

  .profile-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    border-bottom: 1px solid var(--border);
    cursor: pointer;
  }

  .profile-item:hover {
    background: var(--bg-darker);
  }

  .records-list {
    max-height: 300px;
    overflow-y: auto;
    margin: 10px 0;
  }

  .record-entry {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px;
    border-bottom: 1px solid var(--border);
  }

  .record-type {
    color: var(--text-muted);
    font-size: 0.9em;
    margin: 0 10px;
  }

  .new-level-select {
    width: 100%;
    padding: 8px;
    background: var(--bg-darker);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: 6px;
    margin-bottom: 10px;
  }

  .record-entry .deny-btn {
    padding: 4px 8px;
    font-size: 0.9em;
  }

  .country-select {
    width: 100%;
    padding: 8px;
    background: var(--bg-darker);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: 6px;
    margin-bottom: 10px;
  }

  .username-input {
    width: 100%;
    padding: 8px;
    background: var(--bg-darker);
    color: var(--text);
    border: 1px solid var(--border);
    border-radius: 6px;
    margin-bottom: 10px;
  }

  .player-country {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1.1em;
    margin-bottom: 12px;
    padding: 6px 12px;
    background: var(--bg-darker);
    border-radius: 6px;
    display: inline-flex;
  }

  .country-flag {
    font-size: 1.4em;
  }
</style>
</head>
<body>
  <div class="header">
    <h1>Spam Challenge List</h1>
    <p>Ranking the hardest spam challenges in Geometry Dash</p>
  </div>

  <nav class="nav">
    <a href="#leaderboard" id="leaderboardLink">Leaderboard</a>
    <a href="#submit" id="submitLink">Submit Record</a>
  </nav>

  <div class="container">
    <ul class="level-list" id="levelList">
      <!-- Level list will be populated by JavaScript -->
    </ul>

    <div class="submission-form" id="submissionForm">
      <h2 class="leaderboard-title">Submit Your Record</h2>
      <form id="recordForm">
        <div class="form-group">
          <label for="playerName">Player Name:</label>
          <input type="text" id="playerName" required>
        </div>
        <div class="form-group">
          <label for="levelName">Level Name:</label>
          <select id="levelName" class="level-select" required>
            <!-- Options will be populated by JavaScript -->
          </select>
        </div>
        <div class="form-group">
          <label for="videoLink">Video Link:</label>
          <input type="url" id="videoLink" required>
        </div>
        <div class="form-group">
          <label for="comments">Additional Comments:</label>
          <textarea id="comments" rows="4"></textarea>
        </div>
        <button type="submit" class="submit-btn">Submit Record</button>
      </form>
    </div>

    <div class="leaderboard" id="leaderboard">
      <h2 class="leaderboard-title">Global Leaderboard</h2>
      <ul class="player-list" id="playerList">
        <!-- Leaderboard will be populated by JavaScript -->
      </ul>
    </div>
  </div>

  <div class="admin-login">
    <button class="admin-button" id="adminLoginBtn">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
        <circle cx="12" cy="7" r="4"></circle>
      </svg>
    </button>
  </div>

  <div class="overlay" id="overlay"></div>

  <div class="login-form" id="loginForm">
    <h3>Admin Login</h3>
    <div class="form-group">
      <label for="password">Password:</label>
      <input type="password" id="password" required>
    </div>
    <div class="button-group">
      <button type="button" class="submit-btn" id="loginSubmit">Login</button>
      <button type="button" class="cancel-btn" id="loginCancel">Cancel</button>
    </div>
  </div>

  <div class="admin-panel" id="adminPanel">
    <button class="close-admin" id="closeAdmin">&times;</button>
    <h2>Admin Panel</h2>
    
    <div class="admin-tab-navigation">
      <button class="admin-tab active" data-tab="levels">Levels</button>
      <button class="admin-tab" data-tab="records">Records</button>
    </div>

    <div class="admin-tab-content active" id="levelsTab">
      <div class="admin-grid" id="adminLevelList">
        <!-- Level editors populated here -->
      </div>
    </div>

    <div class="admin-tab-content" id="recordsTab">
      <div class="records-section">
        <h3>Pending Records</h3>
        <div class="records-list" id="recordsList">
          <!-- Records populated here -->
        </div>
      </div>
    </div>

    <button class="submit-btn" id="saveChanges">Save Changes</button>
  </div>

  <div class="player-profile" id="playerProfile">
    <button class="close-profile" id="closeProfile">&times;</button>
    <h2 id="profileName"></h2>
    <div class="player-profile-stats">
      <div id="profilePoints"></div>
      <div class="player-country" id="profileCountry"></div>
    </div>
    <div class="player-completions" id="profileCompletions">
      <!-- Completions will be populated by JavaScript -->
    </div>
  </div>

  <script>
    function addCountryDataToLocalStorage() {
      const countryData = localStorage.getItem('spamChallengeCountryData');
      if (!countryData) {
        localStorage.setItem('spamChallengeCountryData', JSON.stringify({}));
      }
    }

    function saveCountryData(username, country) {
      const countryData = JSON.parse(localStorage.getItem('spamChallengeCountryData') || '{}');
      countryData[username] = country;
      localStorage.setItem('spamChallengeCountryData', JSON.stringify(countryData));
    }

    function getCountryData(username) {
      const countryData = JSON.parse(localStorage.getItem('spamChallengeCountryData') || '{}');
      return countryData[username] || null;
    }

    function removeCountryData() {
      const countryData = JSON.parse(localStorage.getItem('spamChallengeCountryData') || '{}');
      delete countryData['Creator 10'];
      localStorage.setItem('spamChallengeCountryData', JSON.stringify(countryData));
    }

    let currentLevels = [
      {
        name: "Cosmic Cyclone",
        creator: "SpamMaster", 
        cps: "14",
        fps: "360",
        victors: ["ClickGod", "SpamKing"]
      },
      {
        name: "Acheron",
        creator: "ThunderKing",
        cps: "12", 
        fps: "360",
        victors: ["SpamKing", "ClickMaster"]
      },
      {
        name: "Slaughterhouse",
        creator: "SpeedLord",
        cps: "15",
        fps: "360", 
        victors: ["ClickMaster"]
      }
    ];

    let pendingRecords = [];

    function saveToLocalStorage() {
      try {
        localStorage.setItem('spamChallengeLevels', JSON.stringify(currentLevels));
      } catch (error) {
        console.error('Error saving to localStorage:', error);
      }
    }

    function loadFromLocalStorage() {
      try {
        const savedLevels = localStorage.getItem('spamChallengeLevels');
        if (savedLevels) {
          currentLevels = JSON.parse(savedLevels);
        } else {
          // If no saved data exists, save the default levels
          saveToLocalStorage();
        }
      } catch (error) {
        console.error('Error loading from localStorage:', error);
      }
    }

    function loadFromLocalStorageRecords() {
      try {
        const savedRecords = localStorage.getItem('spamChallengePendingRecords');
        if (savedRecords) {
          pendingRecords = JSON.parse(savedRecords);
        }
        if (!Array.isArray(pendingRecords)) {
          pendingRecords = [];
        }
      } catch (error) {
        console.error('Error loading records from localStorage:', error);
        pendingRecords = [];
      }
    }

    function saveRecordsToLocalStorage() {
      localStorage.setItem('spamChallengePendingRecords', JSON.stringify(pendingRecords));
    }

    function updateArrowButtonStates() {
      const levelEditors = document.querySelectorAll('.level-editor');
      levelEditors.forEach((editor, index) => {
        const upBtn = editor.querySelector('.up-btn');
        const downBtn = editor.querySelector('.down-btn');
        
        if (upBtn) {
          upBtn.disabled = index === 0;
        }
        
        if (downBtn) {
          downBtn.disabled = index === levelEditors.length - 1;
        }
      });
    }

    function showPlayerProfile(playerName) {
      const profileModal = document.getElementById('playerProfile');
      const overlay = document.getElementById('overlay');
      const profileNameEl = document.getElementById('profileName');
      const profilePointsEl = document.getElementById('profilePoints');
      const profileCountryEl = document.getElementById('profileCountry');
      const profileCompletionsEl = document.getElementById('profileCompletions');

      // Set player name
      profileNameEl.textContent = playerName;

      // Set points
      const points = playerPoints[playerName] || 0;
      profilePointsEl.textContent = `Total Points: ${Math.round(points)}`;

      // Set country if available
      const countryData = getCountryData(playerName);
      if (countryData) {
        profileCountryEl.innerHTML = `<span class="country-flag">${countryData}</span> ${countryData}`;
      } else {
        profileCountryEl.innerHTML = 'Country not set';
      }

      // Get completions
      const completions = currentLevels
        .map((level, index) => {
          if (level.creator === playerName || level.victors.includes(playerName)) {
            const points = calculatePoints(index + 1);
            return {
              name: level.name,
              position: index + 1,
              points: points,
              type: level.creator === playerName ? 'Creator' : 'Victor'
            };
          }
          return null;
        })
        .filter(completion => completion !== null);

      // Display completions
      profileCompletionsEl.innerHTML = completions
        .map(completion => `
          <div class="completion-item">
            <div>#${completion.position} ${completion.name}</div>
            <div>${completion.type} - ${Math.round(completion.points)} points</div>
          </div>
        `)
        .join('');

      // Show modal
      profileModal.classList.add('active');
      overlay.classList.add('active');
    }

    // Updated point calculation function
    function calculatePoints(position) {
      // Using quadratic formula to create curve from 250 to 15 points
      const maxPosition = 75;
      const maxPoints = 250;
      const minPoints = 15;
      
      // Calculate position from bottom (reversed ranking)
      const x = maxPosition - position + 1;
      
      // Quadratic scaling formula adjusted to hit exactly 250 at top and 15 at bottom
      const a = (maxPoints - minPoints) / Math.pow(maxPosition, 2);
      const points = a * Math.pow(x, 2) + minPoints;
      
      return Math.round(points);
    }

    // Add player points tracking
    let playerPoints = {};

    function updateLeaderboard() {
      // Reset points before recalculating
      playerPoints = {};
      
      // Calculate points for all levels
      currentLevels.forEach((level, index) => {
        const points = calculatePoints(index + 1);
        
        // Add points to creator
        if (!playerPoints[level.creator]) {
          playerPoints[level.creator] = 0;
        }
        playerPoints[level.creator] += Math.round(points);
        
        // Add points to victors
        level.victors.forEach(victor => {
          if (!playerPoints[victor]) {
            playerPoints[victor] = 0;
          }
          playerPoints[victor] += Math.round(points);
        });
      });

      const playerList = document.getElementById('playerList');
      if (!playerList) return;

      const sortedPlayers = Object.entries(playerPoints)
        .map(([name, points]) => ({ name, points }))
        .sort((a, b) => b.points - a.points);

      playerList.innerHTML = sortedPlayers.map((player, index) => {
        const countryData = getCountryData(player.name);
        const countryFlag = countryData ? `<span class="country-flag">${countryData}</span>` : '';
        
        return `
          <li class="player-item" data-player="${player.name}">
            <span class="player-name">#${index + 1} ${player.name} ${countryFlag}</span>
            <span>${Math.round(player.points)} points</span>
          </li>
        `;
      }).join('');

      // Add click handlers for player profiles
      const playerItems = document.querySelectorAll('.player-item');
      playerItems.forEach(item => {
        item.addEventListener('click', () => {
          const playerName = item.dataset.player;
          showPlayerProfile(playerName);
        });
      });
    }

    function fetchLevels() {
      const levelList = document.getElementById('levelList');
      if (!levelList) return;

      levelList.innerHTML = currentLevels.map((level, index) => {
        const points = calculatePoints(index + 1);
        
        // Create the victors display section only if there are victors
        const victorsSection = level.victors.length > 0 ? `
          <div class="victors-list">
            <button class="toggle-victors">Show Victors (${level.victors.length})</button>
            <div class="victors-dropdown">
              <ul>
                ${level.victors.map(victor => `<li>${victor}</li>`).join('')}
              </ul>
            </div>
          </div>
        ` : '';

        return `
          <li class="level-item">
            <div class="level-rank">#${index + 1}</div>
            <div class="level-info">
              <div class="level-title">${level.name}</div>
              <div class="level-creator">by ${level.creator}</div>
              <div class="level-stats">
                <span>CPS: ${level.cps}</span>
                <span>FPS: ${level.fps}</span>
                <span>Points: ${points}</span>
              </div>
              ${victorsSection}
            </div>
          </li>
        `;
      }).join('');

      // Add click handlers for victors dropdowns
      const toggleButtons = document.querySelectorAll('.toggle-victors');
      toggleButtons.forEach(button => {
        button.addEventListener('click', (e) => {
          e.stopPropagation();
          const dropdown = button.nextElementSibling;
          dropdown.classList.toggle('active');
        });
      });

      // Update leaderboard after loading levels
      updateLeaderboard();
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadFromLocalStorage(); // Load saved data first
      addCountryDataToLocalStorage();
      removeCountryData();
      fetchLevels();
      loadFromLocalStorageRecords(); // Load pending records

      const adminTabs = document.querySelectorAll('.admin-tab');
      const tabContents = document.querySelectorAll('.admin-tab-content');

      adminTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          // Remove active class from all tabs and contents
          adminTabs.forEach(t => t.classList.remove('active'));
          tabContents.forEach(c => c.classList.remove('active'));
          
          // Add active class to clicked tab and corresponding content
          tab.classList.add('active');
          document.getElementById(`${tab.dataset.tab}Tab`).classList.add('active');
        });
      });

      document.getElementById('leaderboardLink').addEventListener('click', (e) => {
        e.preventDefault();
        document.getElementById('leaderboard').scrollIntoView({ behavior: 'smooth' });
      });

      document.getElementById('submitLink').addEventListener('click', (e) => {
        e.preventDefault();
        document.getElementById('submissionForm').classList.add('active');
        document.getElementById('submissionForm').scrollIntoView({ behavior: 'smooth' });
      });

      const levelSelect = document.getElementById('levelName');
      currentLevels.forEach((level, index) => {
        const option = document.createElement('option');
        option.value = level.name;
        option.textContent = `#${index + 1} ${level.name}`;
        levelSelect.appendChild(option);
      });

      document.getElementById('recordForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = {
          playerName: document.getElementById('playerName').value,
          levelName: document.getElementById('levelName').value,
          videoLink: document.getElementById('videoLink').value,
          comments: document.getElementById('comments').value,
          status: 'pending',
          timestamp: Date.now()
        };

        pendingRecords.push(formData);
        saveRecordsToLocalStorage();
        
        alert('Record submitted successfully! Awaiting approval.');
        document.getElementById('recordForm').reset();
        document.getElementById('submissionForm').classList.remove('active');
      });

      const adminLoginBtn = document.getElementById('adminLoginBtn');
      const loginForm = document.getElementById('loginForm');
      const adminPanel = document.getElementById('adminPanel');
      const overlay = document.getElementById('overlay');
      const loginSubmit = document.getElementById('loginSubmit');
      const closeAdmin = document.getElementById('closeAdmin');
      const password = document.getElementById('password');
      const saveChanges = document.getElementById('saveChanges');
      const loginCancel = document.getElementById('loginCancel');

      const ADMIN_PASSWORD = 'Mykah178';

      adminLoginBtn.addEventListener('click', () => {
        loginForm.classList.add('active');
        overlay.classList.add('active');
      });

      loginSubmit.addEventListener('click', () => {
        const enteredPassword = password.value;
        
        if (enteredPassword === ADMIN_PASSWORD) {
          loginForm.classList.remove('active');
          adminPanel.classList.add('active');
          loadAdminPanel();
        } else {
          alert('Incorrect password!');
        }
      });

      closeAdmin.addEventListener('click', () => {
        adminPanel.classList.remove('active');
        overlay.classList.remove('active');
      });

      loginCancel.addEventListener('click', () => {
        loginForm.classList.remove('active');
        overlay.classList.remove('active');
        password.value = ''; // Clear the password field
      });

      async function loadAdminPanel() {
        loadFromLocalStorage();
        const adminLevelList = document.getElementById('adminLevelList');
        adminLevelList.innerHTML = '';
        
        currentLevels.forEach((level, index) => {
          const levelEditor = document.createElement('div');
          levelEditor.className = 'level-editor';
          levelEditor.dataset.position = index + 1;
          levelEditor.innerHTML = `
            <div class="level-editor-header">
              <div class="arrow-controls">
                <button class="arrow-btn up-btn" ${index === 0 ? 'disabled' : ''}>↑</button>
                <button class="arrow-btn down-btn" ${index === currentLevels.length - 1 ? 'disabled' : ''}>↓</button>
              </div>
              <span>#${index + 1} - ${level.name}</span>
              <span class="toggle-icon">▼</span>
            </div>
            <div class="level-editor-content" style="display: none;">
              <div class="form-group">
                <label>Level Name:</label>
                <input type="text" value="${level.name}" class="name-input">
              </div>
              <div class="form-group">
                <label>Creator:</label>
                <input type="text" value="${level.creator}" class="creator-input">
              </div>
              <div class="form-group">
                <label>CPS:</label>
                <input type="text" value="${level.cps}" class="cps-input">
              </div>
              <div class="form-group">
                <label>FPS:</label>
                <input type="text" value="${level.fps}" class="fps-input">
              </div>
              <div class="form-group">
                <label>Victors (comma-separated):</label>
                <input type="text" value="${level.victors.join(', ')}" class="victors-input">
              </div>
            </div>
          `;
          adminLevelList.appendChild(levelEditor);

          // Add click handlers for collapsible content
          const header = levelEditor.querySelector('.level-editor-header');
          const content = levelEditor.querySelector('.level-editor-content');
          const toggleIcon = levelEditor.querySelector('.toggle-icon');
          
          header.addEventListener('click', (e) => {
            if (!e.target.closest('.arrow-btn')) {
              content.style.display = content.style.display === 'none' ? 'block' : 'none';
              toggleIcon.style.transform = content.style.display === 'none' ? 'rotate(0deg)' : 'rotate(180deg)';
            }
          });

          // Add arrow button functionality
          const upBtn = levelEditor.querySelector('.up-btn');
          const downBtn = levelEditor.querySelector('.down-btn');

          upBtn?.addEventListener('click', (e) => {
            e.stopPropagation();
            moveLevel(levelEditor, 'up');
          });
          
          downBtn?.addEventListener('click', (e) => {
            e.stopPropagation();
            moveLevel(levelEditor, 'down');
          });
        });
        updateArrowButtonStates(); // Initial state update
      }

      function moveLevel(levelEditor, direction) {
        const adminLevelList = document.getElementById('adminLevelList');
        const currentIndex = Array.from(adminLevelList.children).indexOf(levelEditor);
        
        if (direction === 'up' && currentIndex > 0) {
          adminLevelList.insertBefore(levelEditor, adminLevelList.children[currentIndex - 1]);
        } else if (direction === 'down' && currentIndex < adminLevelList.children.length - 1) {
          adminLevelList.insertBefore(levelEditor, adminLevelList.children[currentIndex + 2]);
        }

        // Update positions and button states
        try {
          updatePositions();
          updateArrowButtonStates();
          updateMainList();
          saveToLocalStorage(); // Save changes after moving levels
        } catch (err) {
          console.error('Error updating after move:', err);
        }
      }

      function updateMainList() {
        const levelEditors = document.querySelectorAll('.level-editor');
        currentLevels = Array.from(levelEditors).map((editor, index) => {
          return {
            name: editor.querySelector('.name-input').value,
            creator: editor.querySelector('.creator-input').value,
            cps: editor.querySelector('.cps-input').value,
            fps: editor.querySelector('.fps-input').value,
            victors: editor.querySelector('.victors-input').value.split(',').map(v => v.trim()).filter(v => v),
          };
        });
        
        saveToLocalStorage();
        fetchLevels();
        updateLeaderboard();
      }

      function updatePositions() {
        const levelEditors = document.querySelectorAll('.level-editor');
        levelEditors.forEach((editor, index) => {
          editor.dataset.position = index + 1;
          // Update the header to show the correct position
          const header = editor.querySelector('.level-editor-header span');
          const levelName = editor.querySelector('.name-input').value;
          header.textContent = `#${index + 1} - ${levelName}`;
        });
      }

      saveChanges.addEventListener('click', async () => {
        updateMainList();
        saveToLocalStorage(); // Save changes to localStorage
        fetchLevels(); // Refresh the level list and recalculate points
        updateLeaderboard(); // Force an immediate leaderboard refresh
        alert('Changes saved successfully!');
        adminPanel.classList.remove('active');
        overlay.classList.remove('active');
      });

      document.getElementById('closeProfile')?.addEventListener('click', () => {
        document.getElementById('playerProfile').classList.remove('active');
        document.getElementById('overlay').classList.remove('active');
      });
    });
  </script>
</body></html>
